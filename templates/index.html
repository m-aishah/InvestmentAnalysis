<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investment Analysis Tool</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
</head>
<body>
    <header class="bg-primary text-white py-4">
        <div class="container">
            <h1 class="display-4">Welcome to the Investment Analysis Tool</h1>
            <p class="lead">Your go-to solution for smart investment decisions</p>
        </div>
    </header>

    <main class="container my-5">
        <section id="dashboard">
            <h2 class="mb-4">Investment Analysis Dashboard</h2>
            <div class="row">
                <div class="col-md-6">
                    <div class="card mb-4">
                        <div class="card-header">
                            <h4>Recent Analyses</h4>
                        </div>
                        <div class="card-body">
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">
                                    <i class="fas fa-chart-line me-2"></i>
                                    <span id="recent-analyses-count">{{ request_count }}</span> requests since last refresh
                                </li>
                                <li class="list-group-item">
                                    <i class="fas fa-user-friends me-2"></i>
                                    <span id="active-users-count">Loading...</span> active users
                                </li>
                                <li class="list-group-item">
                                    <i class="fas fa-server me-2"></i>
                                    <span id="server-status">Loading...</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card mb-4">
                        <div class="card-header">
                            <h4>Investment Trends</h4>
                        </div>
                        <div class="card-body">
                            <div id="investment-trends-chart"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="features">
            <h2 class="mb-4">What This Tool Does</h2>
            <p>This tool serves as a powerful extension for <a href="https://www.cmnd.ai/" target="_blank">CMND.ai</a>, designed to provide essential information for comprehensive investment analysis. It performs:</p>
            <ul>
                <li><strong>Cost Comparison:</strong> Evaluate and compare property costs based on user-defined criteria.</li>
                <li><strong>Property Details and Insights:</strong> Retrieve and analyze detailed property data, offering valuable insights.</li>
                <li><strong>Rental Income Forecast:</strong> Predict future rental income to aid in making informed investment decisions.</li>
                <li><strong>Overall Investment Recommendations:</strong> Generate tailored recommendations based on the analysis of various factors.</li>
            </ul>
            <p>In addition to its primary functions within CMND.ai, this tool also offers standalone endpoints for independent use. <a href="/docs">See Documentation</a> for more details.</p>
        </section>

        <section id="diagram">
            <h2 class="mb-4">How It Works</h2>
            <img src="{{ url_for('static', filename='diagram.png') }}" alt="System Flow Diagram" class="img-fluid">
            <p class="mt-2">Hover over the diagram for more details.</p>
        </section>

        <section id="links">
            <h2 class="mb-4">Navigate</h2>
            <ul class="list-group">
                <li class="list-group-item">
                    <a href="/cmnd-tools" class="btn btn-primary">
                        <i class="fas fa-chart-pie me-2"></i>
                        Access the main tool interface
                    </a>
                </li>
                <li class="list-group-item">
                    <a href="/run-cmnd-tool" class="btn btn-primary">
                        <i class="fas fa-play-circle me-2"></i>
                        Trigger the analysis process
                    </a>
                </li>
            </ul>
        </section>
    </main>

    <footer class="bg-dark text-white py-3">
        <div class="container">
            <p class="mb-0">Powered by Flask, Caddy, GitHub Actions, and more. Developed by Aishah Mabayoje & Godfrey Dekera.</p>
        </div>
    </footer>

    <script src="{{ url_for('static', filename='scripts.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script>
        function updateDashboard() {
            fetch('/dashboard-data')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('recent-analyses-count').textContent = data.recent_analyses;
                    document.getElementById('active-users-count').textContent = data.active_users;
                    document.getElementById('server-status').textContent = data.server_status;

                    var options = {
                        series: [{
                            name: 'Module Usage',
                            data: Object.values(data.investment_trends)
                        }],
                        chart: {
                            type: 'bar',
                            height: 350,
                        },
                        xaxis: {
                            categories: data.investment_trends_labels
                        }
                    };

                    var chart = new ApexCharts(document.getElementById('investment-trends-chart'), options);
                    chart.render();
                })
                .catch(error => {
                    console.error('Error fetching dashboard data:', error);
                });
        }
        updateDashboard();

        // setInterval(updateDashboard, 10000);

    </script>
</body>
</html>